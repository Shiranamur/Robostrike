@page "/logged"
@inject HttpClient Http
@inject IJSRuntime JS
@inject NavigationManager Navigation
@rendermode InteractiveServer

<h3>Page Logged</h3>

<button @onclick="JoinMatchmaking">Rejoindre le matchmaking</button>

<p>@message</p>

@code {
    private string message = string.Empty;

    private string sessionToken = string.Empty;
    /// <summary>
    /// Appel l'endpoint /api/matchmaking/join pour inscrire un joueur dans la file.
    /// La réponse est affichée dans un paragraphe.
    /// </summary>
    private async Task JoinMatchmaking()
    {
        try
        {
            sessionToken = await JS.InvokeAsync<string>("localStore.get", "sessionToken");
            
            if (string.IsNullOrEmpty(sessionToken))
            {
                Navigation.NavigateTo("/login");
                return;
            }
            
            Http.DefaultRequestHeaders.Authorization =
                new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", sessionToken);
            
            var response = await Http.GetAsync("http://localhost:5181/api/matchmaking/join");
            if (response.IsSuccessStatusCode)
            {
                message = await response.Content.ReadAsStringAsync();
            }
            else
            {
                message = $"Erreur: {response.StatusCode}";
            }
        }
        catch (Exception ex)
        {
            message = ex.Message;
        }
    }
}